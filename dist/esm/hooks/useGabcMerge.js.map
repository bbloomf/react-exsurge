{"version":3,"sources":["../../../src/hooks/useGabcMerge.tsx"],"names":["useGabcMerge","syllabifiedText","musicalNotation","useLargeInitial","text","notation","normalizeInputs","syllables","notationNodes","splitInputs","sylNdx","isFirstSyl","result","map","syllable","nextIndex","isFirstSyllable","mapSyllable","join","trim","length","replace","regexClef","regexNonSyllabicGabc","regexFindParensWithLeadSpaces","regexFindParens","split","filter","syl","stripParens","s","getSyllable","index","getNonSyllable","syllableNdx","test","noSyllable","nextSyllable","slice","capitalizeInitial","toUpperCase","toLowerCase"],"mappings":"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","sourcesContent":["    export const useGabcMerge = (syllabifiedText: string, musicalNotation: string, useLargeInitial: boolean = true) => {\n\n      const { text, notation } = normalizeInputs(syllabifiedText, musicalNotation);\n    \n      if (!text) return notation;\n      if (!notation) return text;\n    \n      const { syllables, notationNodes } = splitInputs(text, notation);\n    \n      let sylNdx = 0\n      let isFirstSyl = true;\n      let result = notationNodes\n        .map((notation) => {\n          const { syllable, nextIndex, isFirstSyllable } = mapSyllable(notation, syllables, sylNdx, isFirstSyl);\n          sylNdx = nextIndex;\n          isFirstSyl = isFirstSyllable;\n          return syllable;\n        })\n        .join('')\n        .trim()\n      ;\n    \n      // add any additional syllables that come after the last notation data:\n      while (sylNdx < syllables.length) {\n        result +=\n          syllables[sylNdx++].replace(/^(\\s*)\"?\\(?(.*?)\\)?\"?$/, '$1$2') + '()';\n      }\n      return result;\n    }\n    \n    /*-----  REGEX DEFS  -----*/\n    const regexClef = /^[cf]b?[1-4]$/;\n    const regexNonSyllabicGabc = /^([cf]b?[1-4]|[,;:`]+|[a-m]\\+|[zZ]0?)+$/;\n    const regexFindParensWithLeadSpaces = /^(\\s*)\\((.*)\\)$/;\n    const regexFindParens = /^\\((.*)\\)$/;\n    \n    /*-----  NORMALIZATION FUNCTIONS  -----*/\n    const normalizeInputs = (text: string, notation: string): { text: string, notation: string } => {\n      // normalize the text, getting rid of multiple consecutive whitespace,\n      // and handling lilypond's \\forceHyphen directive\n      text = text\n        .replace(/%[^\\n]*(\\n|$)/g, '$1')\n        .replace(/\\s*\\n\\s*/g, '\\n')\n        .replace(/(\\s)\\s+/g, '$1')\n        .replace(/\\\\forceHyphen\\s+(\\S+)\\s+--\\s+/g, '$1-')\n        .trim()\n      ;\n    \n      notation = notation.replace(/%[^\\n]*(\\n|$)/g, '$1').trim();\n    \n      return { text, notation }\n    }\n    \n    const splitInputs = (text: string, notation: string): { syllables: string[], notationNodes: string[] } => {\n      const syllables = text\n        .split(/\\s+--\\s+|\\+|(\\s*\\(?\"[^\"]+\"\\)?-?)|([^\\s-+]+-)(?=[^\\s-])|(?=\\s)/)\n        .filter((syl) => syl && syl.trim());\n  \n      const notationNodes = notation.split(/\\s+/);\n    \n      return { syllables, notationNodes };\n    }\n    \n    /*-----  STRING UTIL FUNCTIONS  -----*/\n    const stripParens = (s: string) => {\n      return s.replace(regexFindParensWithLeadSpaces, '$1$2')\n          s.replace(regexFindParens, '$1')\n      ;\n    }\n    \n    /*-----  GETTER FUNCTIONS  -----*/\n    const getSyllable = (syllables: string[], index: number) => {\n      return (syllables[index] || ' ').replace(/^(\\s*)\"(.*)\"$/, '$1$2');\n    }\n    \n    const getNonSyllable = (syllables: string[], syllableNdx: number, notation: string): string => {\n      let syllable = syllables[syllableNdx];\n    \n      if (/^(\\s*!|[^a-záéíóúýàèìòùäëïöüÿæœǽœ́]+$|\\s*\\(.*\\)$|\\s*\"\\(.*\\)\"$)/i.test(syllable)\n          && !regexClef.test(notation)) {\n    \n        return syllable.replace(/^(\\s*)!/, '$1')\n            .replace(/^(\\s*)\"?\\((.*?)\\)\"?$/, '$1$2')\n        ;\n      }\n    \n      return ' ';\n    }\n    \n    /*-----  PROCESSOR FUNCTIONS  -----*/\n    const mapSyllable = (\n      notation: string,\n      syllables: string[],\n      sylNdx: number,\n      isFirstSyllable: boolean\n    ): { syllable: string, nextIndex: number, isFirstSyllable: boolean } => {\n      const noSyllable = regexNonSyllabicGabc.test(notation) || /^\\(.*\\)$/.test(notation);\n      notation = stripParens(notation);\n    \n      let syllable = noSyllable ? getNonSyllable(syllables, sylNdx, notation) : getSyllable(syllables, sylNdx++);\n      if (!noSyllable) {\n        let nextSyllable = syllable;\n        syllable = stripParens(syllable);\n    \n        while (/^\\s*\\(.*\\)$/.test(nextSyllable)) {\n          if (/^\".*\"$/.test(syllable)) {\n            syllable = syllable.slice(1, -1);\n          }\n    \n          nextSyllable = getSyllable(syllables, sylNdx++);\n          syllable += '()' + stripParens(nextSyllable);\n        }\n    \n        if (isFirstSyllable) {\n          isFirstSyllable = false;\n    \n          syllable = capitalizeInitial(syllable, syllables[sylNdx]);\n        }\n      }\n    \n      syllable = syllable + '(' + notation + ')';\n    \n      return { syllable, nextIndex: sylNdx, isFirstSyllable }\n    }\n    \n    const capitalizeInitial = (syllable: string, nextSyllable: string): string => {\n      if (/^\\s*[a-záéíóúýàèìòùäëïöüÿæœǽœ́]+/i.test(syllable)) {\n        // special capitalization rules for the large initial:\n        // the second letter should also be capitalized, and the third as well,\n        // if it is a three letter word\n        syllable = syllable.slice(0, 2).toUpperCase() + syllable.slice(2).toLowerCase();\n        if (syllable.length === 3 && /^\\s/.test(nextSyllable)) {\n          syllable = syllable.toUpperCase();\n        }\n      }\n    \n      return syllable;\n    }\n    "],"file":"useGabcMerge.js"}